<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <title>팻머스 문화선교회 창립 20주년 감사예배</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* * 디자인 커스터마이징 섹션
         * 이곳에서 초대장의 주요 색상과 글꼴을 쉽게 변경할 수 있습니다.
         */
        :root {
            --font-main: 'Noto Sans KR', sans-serif;
            --color-primary: #2C3E50; /* 네이비 계열 */
            --color-secondary: #EAECEE; /* 연한 회색 계열 */
            --color-accent: #F39C12; /* 포인트 오렌지/골드 계열 */
            --color-background: #F8F9F9; /* 매우 연한 배경색 */
            --color-text-dark: #3a3a3a;
            --color-text-light: #5d5d5d;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--color-background);
            color: var(--color-text-dark);
        }

        .bg-primary { background-color: var(--color-primary); }
        .text-primary { color: var(--color-primary); }
        .bg-secondary { background-color: var(--color-secondary); }
        .text-secondary { color: var(--color-secondary); }
        .bg-accent { background-color: var(--color-accent); }
        .text-accent { color: var(--color-accent); }
        .border-primary { border-color: var(--color-primary); }

        /* 로딩 스피너 스타일 */
        .loader {
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--color-primary);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto max-w-2xl p-4 sm:p-8">
        
        <!-- 초대장 섹션 -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden p-6 sm:p-10 text-center">
            
            <header class="mb-8">
                <!-- *** 로고 이미지 *** -->
                <!-- [중요] 엑박 문제 해결을 위해 이미지 주소를 외부 링크로 변경해야 합니다. -->
                <!-- 아래 src="..." 부분에 이미지 파일의 '직접 링크(URL)'를 붙여넣어 주세요. (아래 설명 참고) -->
                <img src="https://i.postimg.cc/28QVsbbj/logo-1.png" alt="팻머스 로고" class="w-24 h-auto mx-auto mb-6">
                
                <h1 class="text-3xl sm:text-4xl font-bold text-primary mb-2 leading-tight">
                    팻머스 문화선교회<br>
                    <span class="text-2xl sm:text-3xl font-normal">창립 20주년 감사예배</span>
                </h1>
            </header>
            
            <!-- 초대 문구 -->
            <section class="mb-10 text-gray-600 leading-relaxed text-center">
                <p class="mb-4">하나님의 은혜로 팻머스 문화선교회가 창립 20주년을 맞이하게 되었습니다.</p>
                <p class="mb-4">그 여정 속에서 함께 걸어주신 귀한 분들께 감사의 마음을 전하고자 작은 자리를 마련했습니다.</p>
                <p class="mb-4">지난 시간을 돌아보며 감사의 이야기를 나누고, 다가올 새로운 길을 함께 그려가는 따뜻한 시간이 되기를 소망합니다.</p>
                <p class="font-semibold">귀한 걸음을 하셔서 자리를 빛내 주시길 부탁드립니다.</p>
            </section>

            <!-- 행사 정보 -->
            <section class="bg-secondary bg-opacity-50 rounded-xl p-6 mb-8 text-left space-y-4">
                <div class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-primary flex-shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                    <div>
                        <h3 class="font-bold text-gray-800">일시</h3>
                        <p class="text-gray-600">2025년 10월 27일 (월) 오후 6시 30분</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-primary flex-shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    <div>
                        <h3 class="font-bold text-gray-800">장소</h3>
                        <p class="text-gray-600">청운교회 비전센터 10층 (서울 강남구 언주로65길 6)</p>
                    </div>
                </div>
                <div class="flex items-start">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-primary flex-shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 15.818l-5.455-2.273L15 12l.545-1.545L21 8.182m-4.5 7.636V21m0 0L15 18.5m1.5 2.5L18 18.5m-3-6.5l-3 3m0 0l-3-3m3 3V3m0 0l3 3m-3-3l-3 3" />
                    </svg>
                    <div>
                        <h3 class="font-bold text-gray-800">식사 안내</h3>
                        <p class="text-gray-600">정성껏 준비한 뷔페식이 제공됩니다.</p>
                    </div>
                </div>
            </section>
            
            <!-- 버튼 그룹 -->
            <section class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <a href="https://naver.me/5dAjjl9Z" target="_blank" class="w-full bg-primary text-white font-bold py-3 px-4 rounded-lg hover:bg-opacity-90 transition-colors duration-300 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l5.447 2.724A1 1 0 0021 16.382V5.618a1 1 0 00-1.447-.894L15 7m-6 10l6-3m0 0l-6-4m6 4v10" /></svg>
                    오시는 길
                </a>
                <a id="addToCalendar" href="#" target="_blank" class="w-full bg-accent text-white font-bold py-3 px-4 rounded-lg hover:bg-opacity-90 transition-colors duration-300 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg>
                    캘린더에 추가
                </a>
            </section>
        </div>

        <!-- RSVP 폼 섹션 -->
        <div class="bg-white rounded-2xl shadow-lg mt-8 p-6 sm:p-10">
            <h2 class="text-2xl font-bold text-center mb-2 text-primary">참석 회신 (RSVP)</h2>
            <p class="text-center text-gray-600 mb-8">원활한 행사 준비를 위해 아래 정보를 작성해 주시면 큰 도움이 됩니다.</p>

            <form id="rsvp-form" class="space-y-6">
                <!-- 기본 정보 -->
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">성함</label>
                    <input type="text" name="성함" id="name" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                </div>
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">연락처</label>
                    <input type="tel" name="연락처" id="phone" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                </div>
                
                <!-- 참석 여부 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">참석 여부</label>
                    <div class="flex space-x-4">
                        <label class="flex items-center">
                            <input type="radio" name="참석여부" value="참석" id="attendance-yes" class="h-4 w-4 text-primary focus:ring-primary border-gray-300" required>
                            <span class="ml-2 text-gray-700">예, 참석합니다</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="참석여부" value="불참" id="attendance-no" class="h-4 w-4 text-primary focus:ring-primary border-gray-300">
                            <span class="ml-2 text-gray-700">아니오, 불참합니다</span>
                        </label>
                    </div>
                </div>
                
                <!-- 조건부 섹션: 참석 시에만 보임 -->
                <div id="conditional-sections" class="space-y-6 hidden">
                    <!-- 동행인 정보 -->
                    <div>
                        <label for="accompanying" class="block text-sm font-medium text-gray-700 mb-1">동행 인원</label>
                        <p class="text-xs text-gray-500 mb-2">배우자, 자녀 등 함께 오시는 분들의 정보를 적어주세요.</p>
                        <input type="text" name="동행인원" id="accompanying" placeholder="예: 배우자 1명, 자녀 2명" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    
                    <!-- 차량 이용 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">차량 이용 여부</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="차량이용" value="예" id="vehicle-yes" class="h-4 w-4 text-primary focus:ring-primary border-gray-300">
                                <span class="ml-2 text-gray-700">예</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="차량이용" value="아니오" id="vehicle-no" class="h-4 w-4 text-primary focus:ring-primary border-gray-300">
                                <span class="ml-2 text-gray-700">아니오</span>
                            </label>
                        </div>
                    </div>

                    <!-- 차량 번호 (조건부) -->
                    <div id="vehicle-number-section" class="hidden">
                        <label for="vehicle-number" class="block text-sm font-medium text-gray-700 mb-1">차량 번호</label>
                        <input type="text" name="차량번호" id="vehicle-number" placeholder="예: 12가 3456" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                </div>

                <!-- 전하실 말씀 -->
                <div>
                    <label for="memo" class="block text-sm font-medium text-gray-700 mb-1">전하실 말씀</label>
                    <textarea name="전하실 말씀" id="memo" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"></textarea>
                </div>
                
                <!-- 개인정보 동의 -->
                <div class="relative flex items-start">
                    <div class="flex items-center h-5">
                        <input id="privacy-policy" name="개인정보동의" type="checkbox" required class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                    </div>
                    <div class="ml-3 text-sm">
                        <label for="privacy-policy" class="font-medium text-gray-700">개인정보 수집 및 이용에 동의합니다.</label>
                        <p class="text-gray-500 text-xs">수집된 개인정보는 행사 준비 및 안내 목적으로만 사용됩니다.</p>
                    </div>
                </div>

                <!-- 제출 버튼 -->
                <div>
                    <button type="submit" id="submit-btn" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-primary hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:bg-gray-400 disabled:cursor-not-allowed">
                        <span id="submit-text">회신 제출</span>
                        <div id="submit-loader" class="loader hidden"></div>
                    </button>
                </div>
            </form>

            <!-- 제출 결과 메시지 -->
            <div id="form-status" class="mt-6 text-center"></div>
            
            <!-- 문의처 -->
            <footer class="mt-10 pt-6 border-t border-gray-200 text-center">
                <p class="text-sm font-semibold text-gray-700">문의</p>
                <p class="text-sm text-gray-500 mt-1">최일모 본부장 (010-9163-5897)</p>
                <p class="text-sm text-gray-500">최선 본부장 (010-6543-9629)</p>
            </footer>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            // --- Google Sheets 연동 설정 ---
            // 중요! 아래 URL을 본인의 Google Apps Script 웹 앱 URL로 변경해주세요.
            const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbyXwLEf626h_DhAeiMciSR58V3vbgs2qDTtALA4GAWob5jP5JRSHWWqjJYb5vnV2wKq/exec'; // <-- 여기에 URL을 붙여넣으세요.
            
            /* [Google Sheets 연동 방법]
            1. 새 Google Sheets 파일을 만듭니다.
            2. 첫 번째 행에 헤더를 입력합니다. (예: 성함, 연락처, 참석여부, 동행인원, 차량이용, 차량번호, 전하실 말씀, 개인정보동의, 제출일시)
               - 헤더 이름은 form의 'name' 속성과 정확히 일치해야 합니다.
            3. 상단 메뉴에서 [확장 프로그램] > [Apps Script]로 이동합니다.
            4. 아래의 Apps Script 코드를 복사하여 붙여넣고 저장합니다.
            
            ------------------ Apps Script 코드 시작 ------------------
            function doPost(e) {
              try {
                var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Sheet1"); // 시트 이름을 확인하세요.
                
                // 헤더를 기반으로 데이터 순서 정렬
                var headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
                var newRow = headers.map(function(header) {
                  // '제출일시' 헤더가 있으면 현재 시간을 추가
                  if (header === "제출일시") {
                    return new Date();
                  }
                  return e.parameter[header] !== undefined ? e.parameter[header] : '';
                });
                
                sheet.appendRow(newRow);
                
                return ContentService
                  .createTextOutput(JSON.stringify({ "result": "success" }))
                  .setMimeType(ContentService.MimeType.JSON);
              } catch (error) {
                return ContentService
                  .createTextOutput(JSON.stringify({ "result": "error", "message": error.toString() }))
                  .setMimeType(ContentService.MimeType.JSON);
              }
            }
            ------------------- Apps Script 코드 끝 -------------------
            
            5. Apps Script 편집기 우측 상단의 [배포] > [새 배포]를 클릭합니다.
            6. '유형 선택'에서 톱니바퀴 아이콘을 클릭하고 '웹 앱'을 선택합니다.
            7. '웹 앱' 설정에서:
               - 설명: (선택 사항) RSVP 폼
               - 다음 사용자로 실행: 나 (your-email@gmail.com)
               - 액세스 권한이 있는 사용자: 전체 공개
            8. [배포] 버튼을 클릭하고, 권한 검토 팝업이 뜨면 계정을 선택하고 [허용]합니다.
            9. 생성된 '웹 앱 URL'을 복사하여 위 'GOOGLE_SHEET_URL' 변수에 붙여넣습니다.
            */


            // --- 캘린더에 추가 기능 ---
            const calendarLink = document.getElementById('addToCalendar');
            const event = {
                title: '팻머스 문화선교회 창립 20주년 감사예배',
                start: '20251027T183000', // YYYYMMDDTHHMMSS
                end: '20251027T213000', // 종료 시간을 넉넉하게 3시간으로 설정
                location: '서울 강남구 언주로65길 6, 청운교회 비전센터 10층',
                description: '팻머스 문화선교회 20주년 감사예배에 초대합니다.'
            };
            const googleCalendarUrl = `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(event.title)}&dates=${event.start}/${event.end}&details=${encodeURIComponent(event.description)}&location=${encodeURIComponent(event.location)}`;
            calendarLink.href = googleCalendarUrl;

            
            // --- RSVP 폼 조건부 로직 ---
            const form = document.getElementById('rsvp-form');
            const attendanceYes = document.getElementById('attendance-yes');
            const attendanceNo = document.getElementById('attendance-no');
            const conditionalSections = document.getElementById('conditional-sections');
            
            const vehicleYes = document.getElementById('vehicle-yes');
            const vehicleNo = document.getElementById('vehicle-no');
            const vehicleNumberSection = document.getElementById('vehicle-number-section');
            const vehicleNumberInput = document.getElementById('vehicle-number');

            function toggleConditionalSections() {
                if (attendanceYes.checked) {
                    conditionalSections.classList.remove('hidden');
                } else {
                    conditionalSections.classList.add('hidden');
                    // 불참 선택 시 하위 선택사항 초기화
                    vehicleYes.checked = false;
                    vehicleNo.checked = false;
                    toggleVehicleNumberSection();
                }
            }

            function toggleVehicleNumberSection() {
                if (vehicleYes.checked) {
                    vehicleNumberSection.classList.remove('hidden');
                    vehicleNumberInput.required = true;
                } else {
                    vehicleNumberSection.classList.add('hidden');
                    vehicleNumberInput.required = false;
                    vehicleNumberInput.value = ''; // 값 초기화
                }
            }

            attendanceYes.addEventListener('change', toggleConditionalSections);
            attendanceNo.addEventListener('change', toggleConditionalSections);
            vehicleYes.addEventListener('change', toggleVehicleNumberSection);
            vehicleNo.addEventListener('change', toggleVehicleNumberSection);


            // --- 폼 제출 로직 ---
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const submitLoader = document.getElementById('submit-loader');
            const formStatus = document.getElementById('form-status');

            form.addEventListener('submit', function(e) {
                e.preventDefault();

                if (GOOGLE_SHEET_URL === '') {
                    showStatusMessage('Google Sheets URL이 설정되지 않았습니다. 스크립트 내 안내를 확인해주세요.', true);
                    return;
                }

                // 로딩 상태 UI 변경
                submitBtn.disabled = true;
                submitText.classList.add('hidden');
                submitLoader.classList.remove('hidden');
                formStatus.innerHTML = '';

                const formData = new FormData(form);
                
                fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        showStatusMessage('회신이 성공적으로 제출되었습니다. 감사합니다!', false);
                        form.reset();
                        // 폼 리셋 후 조건부 섹션 숨기기
                        toggleConditionalSections();
                    } else {
                        throw new Error(data.message || '알 수 없는 오류가 발생했습니다.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showStatusMessage(`제출 중 오류가 발생했습니다. 다시 시도해 주세요. (${error.message})`, true);
                })
                .finally(() => {
                    // 로딩 상태 UI 복원
                    submitBtn.disabled = false;
                    submitText.classList.remove('hidden');
                    submitLoader.classList.add('hidden');
                });
            });

            function showStatusMessage(message, isError) {